<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>寅林创客课程教师管理系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#4F46E5',
                        secondary: '#10B981',
                        accent: '#F59E0B',
                        neutral: '#6B7280',
                        light: '#F3F4F6',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
            .scrollable-courses {
                max-height: 600px;
                overflow-y: auto;
                scrollbar-width: thin;
            }
            .scrollable-courses::-webkit-scrollbar {
                width: 6px;
            }
            .scrollable-courses::-webkit-scrollbar-thumb {
                background-color: rgba(79, 70, 229, 0.5);
                border-radius: 3px;
            }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- 头部导航 -->
    <header class="bg-primary text-white shadow-md">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold flex items-center">
                <i class="fa fa-graduation-cap mr-2"></i>寅林创客课程教师管理系统
            </h1>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="container mx-auto px-4 py-8">
        <!-- 教师登录区 -->
        <section id="teacherLogin" class="max-w-md mx-auto bg-white rounded-lg shadow-lg p-8 mb-8">
            <h2 class="text-2xl font-bold text-center mb-6 text-gray-800">教师登录</h2>
            <div class="mb-4">
                <label for="teacherPassword" class="block text-gray-700 mb-2">密码</label>
                <input type="password" id="teacherPassword" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="请输入密码">
            </div>
            <button id="teacherLoginBtn" class="w-full bg-primary text-white py-3 rounded-md font-medium hover:bg-primary-700 transition-custom">
                登录
            </button>
            <p class="text-gray-500 text-center mt-4 text-sm">默认密码: teacher123</p>
        </section>

        <!-- 教师查看区 -->
        <section id="teacherArea" class="hidden">
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">出勤情况管理</h2>
                    <div class="flex items-center space-x-4">
                        <button id="exportDataBtn" class="bg-secondary text-white px-4 py-2 rounded-md font-medium hover:bg-secondary-700 transition-custom">
                            <i class="fa fa-download mr-1"></i> 导出数据
                        </button>
                        <button id="teacherLogout" class="text-primary hover:text-primary-700 transition-custom">
                            <i class="fa fa-sign-out mr-1"></i> 退出登录
                        </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <h3 class="text-blue-700 font-medium mb-1">总课程数</h3>
                        <p class="text-2xl font-bold text-blue-800" id="totalCourses">0</p>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg border border-green-100">
                        <h3 class="text-green-700 font-medium mb-1">已确认出勤</h3>
                        <p class="text-2xl font-bold text-green-800" id="totalAttending">0</p>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-100">
                        <h3 class="text-yellow-700 font-medium mb-1">未确认出勤</h3>
                        <p class="text-2xl font-bold text-yellow-800" id="totalUnconfirmed">0</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <label for="courseFilter" class="block text-gray-700 mb-2">选择课程</label>
                    <select id="courseFilter" class="px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                        <option value="all">所有课程</option>
                        <option value="SC三级">SC三级</option>
                        <option value="科学创客">科学创客</option>
                    </select>
                </div>
                
                <div id="teacherCourses" class="space-y-8 scrollable-courses">
                    <!-- 课程出勤情况将通过JavaScript动态生成 -->
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-gray-800 text-white py-6">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2025 寅林创客课程教师管理系统 - 版权所有</p>
        </div>
    </footer>

    <script>
        // 课程数据 - 与家长系统保持一致，确保数据同步
        const courses = [
            {
                id: 1,
                name: "SC三级",
                time: "每周五 19:00-20:30",
                startDate: "2025-09-12",
                students: ["徐俊恩", "单烨坾"],
                weeks: 15
            },
            {
                id: 2,
                name: "科学创客",
                time: "每周六 19:00-20:30",
                startDate: "2025-09-13",
                students: ["徐佳雯", "佳雯妹妹", "金峻锐", "周靖航", "曾一鑫"],
                weeks: 15
            }
        ];

        // 从本地存储获取确认数据
        let confirmationData = JSON.parse(localStorage.getItem('confirmationData')) || {};
        
        // 初始化确认数据结构（如果本地存储中没有数据）
        function initConfirmationData() {
            // 检查数据是否已存在，不存在则初始化
            if (Object.keys(confirmationData).length === 0) {
                courses.forEach(course => {
                    confirmationData[course.id] = {};
                    
                    // 生成每周的课程日期
                    const courseDates = generateCourseDates(course.startDate, course.weeks);
                    
                    courseDates.forEach((date, weekIndex) => {
                        const weekKey = `week${weekIndex + 1}`;
                        confirmationData[course.id][weekKey] = {
                            date: date,
                            students: {}
                        };
                        
                        // 为每个学生初始化状态为未确认
                        course.students.forEach(student => {
                            confirmationData[course.id][weekKey].students[student] = null;
                        });
                    });
                });
                
                // 保存到本地存储
                saveConfirmationData();
            }
        }

        // 生成课程日期
        function generateCourseDates(startDate, weeks) {
            const dates = [];
            const start = new Date(startDate);
            
            for (let i = 0; i < weeks; i++) {
                const current = new Date(start);
                current.setDate(start.getDate() + (i * 7));
                const dateStr = current.toISOString().split('T')[0];
                dates.push(dateStr);
            }
            
            return dates;
        }

        // 保存确认数据到本地存储
        function saveConfirmationData() {
            localStorage.setItem('confirmationData', JSON.stringify(confirmationData));
        }

        // 教师登录
        document.getElementById('teacherLoginBtn').addEventListener('click', function() {
            const password = document.getElementById('teacherPassword').value;
            if (password !== 'teacher123') {
                alert('密码错误，请重新输入');
                return;
            }
            
            document.getElementById('teacherLogin').classList.add('hidden');
            document.getElementById('teacherArea').classList.remove('hidden');
            
            // 显示所有课程的出勤情况
            renderTeacherCourses();
            updateStatistics();
        });

        // 教师退出登录
        document.getElementById('teacherLogout').addEventListener('click', function() {
            document.getElementById('teacherArea').classList.add('hidden');
            document.getElementById('teacherLogin').classList.remove('hidden');
            document.getElementById('teacherPassword').value = '';
        });

        // 课程筛选
        document.getElementById('courseFilter').addEventListener('change', function() {
            renderTeacherCourses();
        });

        // 导出数据功能
        document.getElementById('exportDataBtn').addEventListener('click', function() {
            const dataStr = JSON.stringify(confirmationData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `寅林创客课程出勤数据_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('数据导出成功！');
        });

        // 更新统计信息
        function updateStatistics() {
            let totalCourses = 0;
            let totalAttending = 0;
            let totalUnconfirmed = 0;
            
            // 遍历所有课程
            courses.forEach(course => {
                totalCourses++;
                
                // 遍历所有周次
                for (let i = 1; i <= course.weeks; i++) {
                    const weekKey = `week${i}`;
                    const weekData = confirmationData[course.id][weekKey];
                    
                    // 统计每个学生的状态
                    course.students.forEach(student => {
                        if (weekData.students[student] === true) {
                            totalAttending++;
                        } else if (weekData.students[student] === null) {
                            totalUnconfirmed++;
                        }
                    });
                }
            });
            
            // 更新UI显示
            document.getElementById('totalCourses').textContent = totalCourses;
            document.getElementById('totalAttending').textContent = totalAttending;
            document.getElementById('totalUnconfirmed').textContent = totalUnconfirmed;
        }

        // 渲染教师端的课程
        function renderTeacherCourses() {
            const teacherCoursesContainer = document.getElementById('teacherCourses');
            teacherCoursesContainer.innerHTML = '';
            const selectedCourse = document.getElementById('courseFilter').value;
            
            let filteredCourses = courses;
            if (selectedCourse !== 'all') {
                filteredCourses = courses.filter(course => course.name === selectedCourse);
            }
            
            filteredCourses.forEach(course => {
                const courseElement = document.createElement('div');
                courseElement.className = 'border border-gray-200 rounded-lg overflow-hidden card-shadow';
                
                let courseHTML = `
                    <div class="bg-primary text-white p-4">
                        <h3 class="text-xl font-semibold">${course.name}</h3>
                        <p>${course.time} | 从${course.startDate}开始 | 共${course.weeks}周</p>
                        <p>学生: ${course.students.join(', ')}</p>
                    </div>
                    <div class="p-4">
                `;
                
                // 获取该课程的所有周次
                for (let i = 1; i <= course.weeks; i++) {
                    const weekKey = `week${i}`;
                    const weekData = confirmationData[course.id][weekKey];
                    const date = new Date(weekData.date);
                    const formattedDate = `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date.getDate().toString().padStart(2, '0')}`;
                    
                    // 统计出勤情况
                    const total = course.students.length;
                    const attending = course.students.filter(student => 
                        weekData.students[student] === true
                    ).length;
                    const notAttending = course.students.filter(student => 
                        weekData.students[student] === false
                    ).length;
                    const unconfirmed = total - attending - notAttending;
                    
                    courseHTML += `
                        <div class="mb-6 last:mb-0">
                            <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-2">
                                <h4 class="font-semibold text-gray-800">第${i}周: ${formattedDate} (${course.time})</h4>
                                <div class="text-sm mt-1 md:mt-0">
                                    <span class="text-green-600 mr-3"><i class="fa fa-check-circle"></i> 参加: ${attending}</span>
                                    <span class="text-red-600 mr-3"><i class="fa fa-times-circle"></i> 不参加: ${notAttending}</span>
                                    <span class="text-yellow-600"><i class="fa fa-question-circle"></i> 未确认: ${unconfirmed}</span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                    `;
                    
                    // 列出每个学生的出勤状态，教师可以直接修改
                    course.students.forEach(student => {
                        let statusClass = 'bg-yellow-100 text-yellow-800 border border-yellow-300';
                        let statusText = '未确认';
                        let statusIcon = 'fa-question-circle';
                        
                        if (weekData.students[student] === true) {
                            statusClass = 'bg-green-100 text-green-800 border border-green-300';
                            statusText = '参加';
                            statusIcon = 'fa-check-circle';
                        } else if (weekData.students[student] === false) {
                            statusClass = 'bg-red-100 text-red-800 border border-red-300';
                            statusText = '不参加';
                            statusIcon = 'fa-times-circle';
                        }
                        
                        courseHTML += `
                            <div class="flex items-center justify-between p-2 rounded-md border ${statusClass} text-sm">
                                <span>${student}</span>
                                <div class="flex space-x-1">
                                    <button class="teacher-status-btn p-1 rounded" data-course="${course.id}" data-week="${weekKey}" 
                                            data-student="${student}" data-status="true" title="设为参加">
                                        <i class="fa fa-check ${weekData.students[student] === true ? 'text-green-600' : 'text-gray-400'}"></i>
                                    </button>
                                    <button class="teacher-status-btn p-1 rounded" data-course="${course.id}" data-week="${weekKey}" 
                                            data-student="${student}" data-status="false" title="设为不参加">
                                        <i class="fa fa-times ${weekData.students[student] === false ? 'text-red-600' : 'text-gray-400'}"></i>
                                    </button>
                                    <button class="teacher-status-btn p-1 rounded" data-course="${course.id}" data-week="${weekKey}" 
                                            data-student="${student}" data-status="null" title="设为未确认">
                                        <i class="fa fa-question ${weekData.students[student] === null ? 'text-yellow-600' : 'text-gray-400'}"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    
                    courseHTML += `
                            </div>
                        </div>
                    `;
                }
                
                courseHTML += `</div>`;
                courseElement.innerHTML = courseHTML;
                teacherCoursesContainer.appendChild(courseElement);
            });
            
            // 为教师修改状态的按钮添加事件监听
            document.querySelectorAll('.teacher-status-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const courseId = parseInt(this.getAttribute('data-course'));
                    const weekKey = this.getAttribute('data-week');
                    const student = this.getAttribute('data-student');
                    const status = this.getAttribute('data-status') === 'true' ? true : 
                                  (this.getAttribute('data-status') === 'false' ? false : null);
                    
                    // 更新数据
                    confirmationData[courseId][weekKey].students[student] = status;
                    saveConfirmationData();
                    
                    // 重新渲染以更新UI
                    renderTeacherCourses();
                    updateStatistics();
                });
            });
        }

        // 初始化应用
        function initApp() {
            initConfirmationData();
        }

        // 页面加载完成后初始化
        window.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
    